<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Play Game</title>
  <link rel="stylesheet" href="assets/style.css">
  <script src="assets/script.js"></script>
</head>
<body>

  <!-- Top Navigation -->
  <header class="top-nav">
    <a href="index.html" class="logo">
      <img src="./assets/logo.png" alt="Zovi Games">
    </a>
    <button id="open-auth" class="login-btn">Login</button>
  </header>

  <!-- Game Player -->
  <main class="game-main">
    <h1 id="game-title"></h1>

<iframe
  id="game-frame"
  style="width: 100%; height: 650px; border: none; border-radius: 12px;">
</iframe>

  </main>

  <!-- AUTH MODAL (same as index) -->
  <div id="auth-modal" class="auth-modal">
    <div class="auth-content">
      <span id="close-auth" class="close-auth">&times;</span>
      <h2 id="auth-title">Login</h2>

      <input type="text" id="auth-username" placeholder="Username (sign up only)">
      <input type="email" id="auth-email" placeholder="Email">
      <input type="password" id="auth-password" placeholder="Password">

      <button id="auth-submit">Login</button>

      <div class="auth-alt">
        <button id="google-login">Continue with Google</button>
        <div id="phone-container">
          <div id="recaptcha-container"></div>
          <input type="tel" id="phone-number" placeholder="Phone number">
          <button id="phone-login">Login with Phone</button>
        </div>
      </div>

      <p class="auth-switch">
        Don't have an account? <span id="switch-auth">Sign up</span>
      </p>

      <p id="auth-message" class="auth-message"></p>
    </div>
  </div>

  <!-- Scripts -->
  <script src="script.js"></script>
  <script type="module">
  // Firebase login popup script (same as index.html)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    sendEmailVerification,
    signInWithPopup,
    GoogleAuthProvider,
    RecaptchaVerifier,
    signInWithPhoneNumber,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCJRyyojM9gC4_YX-alWG_NPqIXFp4LgR8",
    authDomain: "zovi-games.firebaseapp.com",
    projectId: "zovi-games",
    storageBucket: "zovi-games.firebasestorage.app",
    messagingSenderId: "398543626097",
    appId: "1:398543626097:web:aebb817c396ed2962460d0"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let isLogin = true;
  const modal = document.getElementById("auth-modal");
  const openBtn = document.getElementById("open-auth");
  const closeBtn = document.getElementById("close-auth");
  const switchBtn = document.getElementById("switch-auth");
  const title = document.getElementById("auth-title");
  const submitBtn = document.getElementById("auth-submit");
  const message = document.getElementById("auth-message");
  const usernameInput = document.getElementById("auth-username");

  openBtn.onclick = () => modal.style.display = "flex";
  closeBtn.onclick = () => modal.style.display = "none";

  switchBtn.onclick = () => {
    isLogin = !isLogin;
    title.textContent = isLogin ? "Login" : "Sign Up";
    submitBtn.textContent = isLogin ? "Login" : "Sign Up";
    switchBtn.textContent = isLogin ? "Sign up" : "Login";
    usernameInput.style.display = isLogin ? "none" : "block";
  };

  submitBtn.onclick = async () => {
    const email = document.getElementById("auth-email").value;
    const password = document.getElementById("auth-password").value;
    const username = usernameInput.value;

    try {
      if (isLogin) {
        await signInWithEmailAndPassword(auth, email, password);
      } else {
        const userCred = await createUserWithEmailAndPassword(auth, email, password);
        await sendEmailVerification(userCred.user);
        await setDoc(doc(db, "users", userCred.user.uid), {
          username: username,
          email: email
        });
        message.textContent = "Verification email sent! Check inbox.";
      }
    } catch (err) {
      message.textContent = err.message;
    }
  };

  document.getElementById("google-login").onclick = async () => {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
  };

  window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
    size: 'normal'
  });

  document.getElementById("phone-login").onclick = async () => {
    const phoneNumber = document.getElementById("phone-number").value;
    const appVerifier = window.recaptchaVerifier;
    const confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, appVerifier);
    const code = prompt("Enter SMS code");
    await confirmationResult.confirm(code);
  };

  onAuthStateChanged(auth, user => {
    if (user) {
      openBtn.textContent = "Logout";
      openBtn.onclick = () => signOut(auth);
      modal.style.display = "none";
    } else {
      openBtn.textContent = "Login";
      openBtn.onclick = () => modal.style.display = "flex";
    }
  });
  </script>

  <script src="assets/script.js"></script>

</body>
</html>
